---
description: データ・ストレージセキュリティ（DB分離、TLS、最小権限、RLS/CLS、バックアップ、監査）
languages:
- c
- javascript
- sql
- yaml
alwaysApply: false
---

## データベースセキュリティガイドライン

このルールは、データ侵害や不正アクセスから保護するため、SQLおよびNoSQLデータベースを安全に設定する方法を示します。

- バックエンドデータベースの保護
  - データベースサーバーを他のシステムから分離し、ホスト接続を制限します。
  - 可能な場合はネットワーク（TCP）アクセスを無効化、ローカルソケットファイルまたは名前付きパイプを使用します。
  - 適切な場合、データベースをlocalhostのみにバインドするよう設定します。
  - ファイアウォールルールで特定ホストへのネットワークポートアクセスを制限します。
  - データベースサーバーをアプリケーションサーバーから分離された別のDMZに配置します。
  - シッククライアントからバックエンドデータベースへの直接接続を許可しません。

- トランスポートレイヤーセキュリティ
  - データベースを暗号化接続のみ許可するよう設定します。
  - データベースサーバーに信頼されたデジタル証明書をインストールします。
  - クライアント接続にはTLSv1.2+とモダンな暗号（AES-GCM、ChaCha20）を使用します。
  - クライアントアプリケーションでデジタル証明書の有効性を検証します。
  - 初期認証だけでなく、すべてのデータベーストラフィックが暗号化されていることを確認します。

- セキュアな認証設定
  - ローカルサーバー接続を含め、常に認証を要求します。
  - 強力で一意なパスワードでアカウントを保護します。
  - アプリケーションまたはサービスごとに専用アカウントを使用します。
  - 必要最小限の権限のみを設定します。
  - アカウントと権限を定期的にレビューします。
  - アプリケーションが廃止されたらアカウントを削除します。
  - スタッフが退職したり、侵害が疑われる場合はパスワードを変更します。

- データベース資格情報の保存
  - アプリケーションソースコードに資格情報を保存しません。
  - Webルート外の設定ファイルに資格情報を保存します。
  - 資格情報アクセスに適切なファイル権限を設定します。
  - 資格情報ファイルをソースコードリポジトリにコミットしません。
  - 利用可能な場合は組み込み機能を使用して資格情報ストレージを暗号化します。
  - 環境変数またはシークレット管理ソリューションを使用します。

- セキュアな権限管理
  - すべてのデータベースアカウントに最小権限の原則を適用します。
  - 組み込みのroot、sa、SYSアカウントを使用しません。
  - アプリケーションアカウントに管理者権限を付与しません。
  - アカウント接続を許可されたホストのみに制限します。
  - 開発、UAT、本番環境で別々のデータベースとアカウントを使用します。
  - 必要な権限のみを付与します（必要に応じてSELECT、UPDATE、DELETE）。
  - 権限昇格を防ぐため、アカウントをデータベースオーナーにしません。
  - 必要に応じてテーブルレベル、カラムレベル、行レベルの権限を実装します。

- データベース設定と堅牢化
  - 必要なセキュリティ更新とパッチを定期的にインストールします。
  - データベースサービスを低権限ユーザーアカウントで実行します。
  - デフォルトアカウントとサンプルデータベースを削除します。
  - トランザクションログをメインデータベースファイルとは別のディスクに保存します。
  - 適切な権限で定期的に暗号化されたデータベースバックアップを設定します。
  - 不要なストアドプロシージャと危険な機能を無効化します。
  - データベース活動の監視とアラートを実装します。

- プラットフォーム固有の堅牢化
  - SQL Server：xp_cmdshell、CLR実行、SQL Browserサービス、混合モード認証（必要な場合を除く）を無効化。
  - MySQL/MariaDB：mysql_secure_installationを実行、ユーザーのFILE特権を無効化。
  - PostgreSQL：PostgreSQLセキュリティドキュメントガイドラインに従います。
  - MongoDB：MongoDBセキュリティチェックリスト要件を実装します。
  - Redis：Redisセキュリティガイドの推奨事項に従います。

まとめ：
データベースシステムを分離し、暗号化接続を強制し、強力な認証を実装し、シークレット管理を使用して資格情報を安全に保存し、最小権限の権限を適用し、データベース設定を堅牢化し、定期的なセキュリティ更新と監視を維持します。
