---
description: 追加の暗号化ガイダンス
languages:
- c
- go
- java
- javascript
- kotlin
- matlab
- php
- python
- ruby
- swift
- typescript
- xml
- yaml
alwaysApply: false
---

## 追加の暗号化とTLS

保存データと転送中のデータに対して、最新の検証済み暗号化を適用します。キーを安全に管理し、TLSを正しく設定し、HSTSを展開し、必要に応じてピンニングを検討します。

### アルゴリズムとモード
- 対称：AES-GCMまたはChaCha20-Poly1305を優先。ECBを避ける。CBCまたはCTRはencrypt-then-MACとのみ使用。
- 非対称：RSA ≥2048または最新のECC（Curve25519/Ed25519）。RSA暗号化にはOAEPを使用。
- ハッシュ化：整合性にはSHA-256以上；MD5/SHA-1を避ける。
- RNG：プラットフォームに適したCSPRNGを使用（例：SecureRandom、crypto.randomBytes、secretsモジュール）。非暗号RNGを決して使用しない。

### キー管理
- 検証済みモジュール（HSM/KMS）内でキーを生成し、パスワードや予測可能な入力から決して生成しない。
- 目的別にキーを分離（暗号化、署名、ラッピング）。侵害時、暗号期間、またはポリシーに基づいてローテーション。
- キーをKMS/HSMまたはボルトに保存；決してハードコードしない；平文の環境変数を避ける。KEKを使用してDEKをラップ；別々に保存。
- トラストストアへのアクセスを制御；更新を検証；すべてのキーアクセスと操作を監査。

### 保存データ
- 機密データを暗号化；保存する機密情報を最小化；可能な場合トークン化。
- 認証済み暗号化を使用；nonce/IVを適切に管理；ソルトをアイテムごとに一意に保つ。
- バックアップを保護：暗号化、アクセス制限、復元テスト、保持管理。

### TLS設定
- プロトコル：TLS 1.3を優先；レガシー互換性のためTLS 1.2のみ許可；TLS 1.0/1.1とSSLを無効化。TLS_FALLBACK_SCSVを有効化。
- 暗号：AEADスイートを優先；NULL/EXPORT/anonを無効化。ライブラリを最新に保つ；圧縮を無効化。
- 鍵交換グループ：x25519/secp256r1を優先；必要に応じて安全なFFDHEグループを設定。
- 証明書：2048ビット以上のキー、SHA-256、正しいCN/SAN。ライフサイクルと失効管理（OCSPステープリング）。
- アプリケーション：サイト全体でHTTPS；HTTP→HTTPSリダイレクト；混合コンテンツを防止；Cookieに`Secure`を設定。

### HSTS
- HTTPS経由でのみStrict-Transport-Securityを送信。段階的ロールアウト：
  - テスト：短いmax-age（例：86400）をincludeSubDomainsと共に
  - 本番：≥1年のmax-age；安全な場合includeSubDomains
  - 成熟後にオプションでpreload；永続性とサブドメインへの影響を理解

### ピンニング
- ブラウザのHPKPを避ける。制御されたクライアント（例：モバイル）で両端を所有している場合のみピンニングを検討。
- バックアップピンを含むSPKIピンニングを優先；安全な更新チャネルを計画；ユーザーバイパスを決して許可しない。
- ローテーションと障害処理を徹底的にテスト；運用リスクを理解。

### 実装チェックリスト
- すべての場所でAEAD；検証済みライブラリのみ；カスタム暗号なし。
- KMS/HSMで生成・保存されたキー；目的別スコープ；ローテーションを文書化。
- 強力な暗号を使用したTLS 1.3/1.2；圧縮オフ；OCSPステープリングオン。
- 段階的計画に従ったHSTSの展開；混合コンテンツを排除。
- 正当化される場合のみピンニングを使用、バックアップと更新パスを含む。

### テスト計画
- プロトコル/暗号/HSTSの自動設定スキャン（例：SSL Labs、testssl.sh）。
- 暗号API誤用のコードレビュー；キーローテーション、バックアップ/復元のテスト。
- 展開された場合、ローテーション/障害のピンニングシミュレーション。
