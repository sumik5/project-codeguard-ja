---
description: CI/CDセキュリティのベストプラクティス
languages:
- javascript
- powershell
- shell
- xml
- yaml
alwaysApply: false
---

CI/CDパイプラインはソフトウェア開発プロセスのバックボーンです。同時に攻撃者にとって高価値なターゲットでもあります。パイプラインを保護することは、コード、インフラストラクチャ、ユーザーを保護するために不可欠です。

### 1. ソースコードを保護

パイプラインはソースコードリポジトリから始まります。

*   **保護されたブランチ：** SCM（GitHub、GitLabなど）で保護されたブランチ（例：`main`、`develop`）を設定します。コードがマージされる前にコードレビューと合格したステータスチェックを要求します。
*   **コミット署名：** コミット署名（例：GPGキーを使用）を強制して、すべてのコミットの作成者を検証し、なりすましを防ぎます。

### 2. シークレットをハードコーディングしない

パイプライン設定ファイルやソースコードにシークレット（APIキー、パスワード、トークン）を決してハードコーディングしないでください。

*   **ベストプラクティス：** 専用のシークレット管理ソリューション（HashiCorp Vault、AWS Secrets Manager、またはCIプラットフォームの組み込みシークレットストアなど）を使用します。パイプラインは実行時にシークレットを取得する必要があります。シークレットがマスクされ、ログに決して表示されないようにします。

    **例（GitHub Actions）：**

    steps:
      - name: Deploy to production
        run: ./deploy.sh
        env:
          API_KEY: ${{ secrets.PROD_API_KEY }} # GitHubの暗号化されたシークレットから取得
    ```

### 3. パイプライン設定をハードニング

*   **最小権限：** パイプラインのID とビルドエージェントに必要最小限のレベルの権限を付与します。ジョブがコードのビルドのみを必要とする場合、デプロイ認証情報を持つべきではありません。
*   **分離されたビルド環境：** 各ジョブ後に破棄されるエフェメラルで分離されたビルド環境（コンテナまたはVM）を使用して、クロスコンタミネーションと横方向の移動を防ぎます。
*   **自動化されたセキュリティスキャン：** セキュリティスキャンをパイプラインに直接統合します。これにより、脆弱性が下流に移動するのを防ぐセキュリティゲートが作成されます。
    *   **SAST（静的解析）：** ソースコードの脆弱性をスキャン。
    *   **SCA（ソフトウェア構成解析）：** 依存関係の既知の脆弱性をスキャン。
    *   **DAST（動的解析）：** テスト環境で実行中のアプリケーションをスキャン。
    *   **IaCスキャン：** Infrastructure-as-Codeファイル（Terraform、CloudFormation）の誤設定をスキャン。

### 4. 依存関係を保護

ソフトウェアは依存関係と同じくらいしか安全ではありません。

*   **バージョン固定：** ロックファイル（`package-lock.json`、`yarn.lock`、`Gemfile.lock`）を使用して、依存関係を特定の信頼できるバージョンに固定します。これにより、悪意のあるパッケージが自動的に取り込まれるのを防ぎます。
*   **整合性の検証：** ハッシュまたはチェックサムを使用してパッケージの整合性を検証するパッケージマネージャー機能を使用します。
*   **プライベートレジストリの使用：** 機密性の高い内部パッケージには、依存関係の混乱攻撃を避けるためにプライベートレジストリを使用します。

### 5. すべてに署名

サプライチェーンの整合性を保証するため、重要な資産に暗号的に署名します。

*   **ベストプラクティス：**
    *   Gitコミットに署名。
    *   ビルド成果物（例：Dockerイメージ、JARファイル）に署名。
    *   デプロイ前に**署名を検証**：すべての成果物が信頼できるキーで署名されていることを確認し、署名されていないまたは無効に署名された成果物を拒否します。
    *   **SLSA（Supply-chain Levels for Software Artifacts）**などのフレームワークを検討して、ソフトウェアの検証可能な管理連鎖を作成します。

これらのプラクティスを日常のワークフローに組み込むことで、高速で効率的であるだけでなく、安全で堅牢なCI/CDパイプラインを構築できます。
