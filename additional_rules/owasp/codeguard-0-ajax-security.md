---
description: クライアント側スクリプトのAJAXセキュリティベストプラクティス
languages:
- c
- html
- javascript
- php
- typescript
alwaysApply: false
---

一般的なWeb脆弱性を防ぐため、AJAXセキュリティのベストプラクティスに従うことが重要です。以下のガイドラインに留意してください：

### 1. 危険なJavaScript関数を避ける

`eval()`、`new Function()`、動的で検証されていない文字列引数を使用した`setTimeout()`、`setInterval()`などの関数でコードを動的に評価することは、重大なセキュリティリスクです。ユーザー入力や信頼できないデータは、コードインジェクション脆弱性につながる可能性があります。

ベストプラクティス：

これらの関数を動的文字列で使用する代わりに、より安全な代替手段を使用します。例えば、`setTimeout`と`setInterval`には無名関数を使用します。

避けるべき例：

```javascript
// 安全でない：インジェクションに脆弱
setTimeout("alert('hello')", 1000);

// 安全：
setTimeout(() => alert('hello'), 1000);
```

### 2. `innerHTML`でのクロスサイトスクリプティング（XSS）防止

`.innerHTML`を使用してWebページにコンテンツを挿入すると、コンテンツが適切にサニタイズされていない場合、XSSにつながる可能性があります。

ベストプラクティス：

テキストのみを挿入する必要がある場合は、`.innerText`または`.textContent`を使用します。HTMLを挿入する必要がある場合は、`.innerHTML`を使用する前にコンテキスト対応のサニタイズライブラリを使用します。

例：

```javascript
// 安全でない：
document.getElementById("div1").innerHTML = untrusted_user_input;

// テキストコンテンツには安全：
document.getElementById("div1").textContent = untrusted_user_input;
```

### 3. 安全なクライアント側暗号化とシークレット処理

クライアント側で暗号化を実行したり、シークレットを処理したりしない。クライアント側のコードは可視化され、攻撃者によって操作される可能性があります。

ベストプラクティス：

暗号化とシークレット管理を含むすべての機密操作は、サーバー上で実行する必要があります。

### 4. 安全なJSONとXMLの作成

文字列連結を使用してJSONまたはXMLを構築すると、エラーが発生しやすく、インジェクション脆弱性につながる可能性があります。

ベストプラクティス：

`JSON.stringify()`のような組み込みブラウザAPIまたは信頼できるサードパーティライブラリを使用してデータをシリアライズします。

例：

```javascript
// 安全でない：
let jsonString = '{"name":"' + name + '","email":"' + email + '"}';

// 安全：
let jsonString = JSON.stringify({ name: name, email: email });
```

### 5. サーバー側でのセキュリティとビジネスロジックの強制

クライアント側の検証はユーザーエクスペリエンスのためのものであり、セキュリティのためのものではありません。攻撃者は簡単にバイパスできます。

ベストプラクティス：

すべてのセキュリティチェックとビジネスロジックを常にサーバー上で強制します。サーバーはクライアントから送信されるデータを決して信頼してはいけません。

### 追加推奨事項：

*   入力検証：AJAXサービスは攻撃者によって直接呼び出される可能性があるため、サーバー上ですべての入力を厳格に検証します。
*   CSRF保護：状態を変更するAJAXリクエストには、CSRF対策トークンを使用します。認証トークンは、CookieのHttpOnlyおよびSecureフラグで安全に保存します。
*   JSONハイジャッキング：古いブラウザでのJSONハイジャッキングを防ぐため、最も外側の要素としてオブジェクトを持つJSONレスポンスを返します。
*   スキーマ検証：AJAXリクエストとレスポンスのデータの構造とタイプを検証するために、JSONまたはXMLスキーマを使用します。
*   OWASPリソース：[OWASP Java Encoder Project](https://owasp.org/www-project-java-encoder/)は、サーバー側エンコーディングの優れたリソースです。