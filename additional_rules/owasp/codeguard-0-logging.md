---
description: セキュアアプリケーションロギング
languages:
- c
- go
- java
- javascript
- php
- python
- ruby
- typescript
alwaysApply: false
---

## アプリケーションロギングセキュリティガイドライン

セキュリティ監視、インシデント対応、コンプライアンスのための安全なアプリケーションロギング実装の重要なプラクティス。

### 目的とユースケース

アプリケーションロギングは、インフラストラクチャロギング単独を超えて、セキュリティと運用目的の両方に重要なデータを提供します。

**セキュリティユースケース**：
- アンチオートメーション監視とセキュリティインシデントの識別
- ポリシー違反と監査証跡の監視
- コンプライアンス監視と調査用データ
- インシデント調査用のアプリケーション固有データの提供
- 脆弱性識別と悪用からの防御支援

### ログに記録すべきイベント

常にこれらのセキュリティ関連イベントをログに記録します：

**入力/出力検証**：
- 入力検証失敗（プロトコル違反、受け入れられないエンコーディング、無効なパラメータ）
- 出力検証失敗（データベースレコードの不一致、無効なデータエンコーディング）

**認証と認可**：
- 認証の成功と失敗
- 認可（アクセス制御）失敗
- セッション管理失敗（Cookie変更、疑わしいJWT検証失敗）

**システムイベント**：
- アプリケーションエラーとシステムイベント（構文/ランタイムエラー、接続問題）
- アプリケーションの起動、シャットダウン、ログ記録初期化
- ネットワーク接続と関連失敗（バックエンドTLS失敗、証明書検証失敗）

**高リスク操作**：
- ユーザー管理アクション（ユーザー追加/削除、権限変更）
- 管理者権限またはデフォルト/共有アカウントの使用
- 機密データへのアクセス（支払いカード保有者データ）
- 暗号化活動（暗号化キーの使用またはローテーション）
- データインポート/エクスポートとファイルアップロード
- デシリアライゼーション失敗

**ビジネスロジックイベント**：
- 法的オプトイン（権限、利用規約、同意）
- 疑わしいビジネスロジック活動（フロー制御のバイパス、制限超過）

### イベント属性

各ログエントリは十分な詳細で「いつ、どこで、誰が、何を」を記録する必要があります：

**いつ**：ログ日時（国際形式）、イベントタイムスタンプ、インタラクション識別子
**どこで**：アプリケーション識別子、アドレス、サービス名、地理位置、コード位置
**誰が**：送信元アドレス、ユーザーアイデンティティ（認証済みの場合）、ユーザータイプ分類
**何を**：イベントタイプ、深刻度、セキュリティイベントフラグ、説明、結果ステータス、理由

### 除外すべきデータ

機密データを直接ログに記録しません - 削除、マスク、サニタイズ、ハッシュ化、または暗号化します：

- アプリケーションソースコードとセッション識別値
- アクセストークンと認証パスワード
- データベース接続文字列と暗号化キー
- 銀行口座または支払いカード保有者データ
- 機密個人データとPII
- ログシステムより高いセキュリティ分類のデータ
- 商業上機密情報

### イベント収集実装

セキュリティ制御を伴うアプリケーション全体のログハンドラーを実装します：

- 他の信頼ゾーンからのイベントデータに対して入力検証を実行
- ログインジェクション攻撃を防ぐためすべてのイベントデータにサニタイゼーションを実行（CR、LF、区切り文字）
- 出力形式に対してデータを正しくエンコード
- データベースに書き込む場合、SQLインジェクション防止を適用
- ログ記録失敗がアプリケーション操作を妨げたり情報漏洩を引き起こさないことを確保
- すべてのサーバーとデバイス間で時刻を同期

### ストレージと保護

**ファイルシステムストレージ**：
- OSとアプリケーションファイルとは別のパーティションを使用
- ディレクトリとファイルに厳格な権限を適用
- ログをWebアクセス可能な場所の外に保持
- Webアクセス可能な場合、プレーンテキストMIMEタイプで設定

**データベースストレージ**：
- ログデータの書き込み専用の別のデータベースアカウントを使用
- 非常に制限的なデータベース、テーブル、関数、コマンド権限を適用

**データ保護**：
- セキュアプロトコル経由で標準フォーマットを使用（syslog経由のCLFS、CEF）
- レコードの変更/削除に対する改ざん検出を組み込む
- 可能な限り早く読み取り専用メディアにログデータを保存またはコピー
- ログへのすべてのアクセスを記録・監視
- ログデータ読み取り権限を制限し定期的にレビュー

### セキュア送信

信頼できないネットワーク経由でログデータを送信する場合：
- セキュア送信プロトコルを使用
- イベントデータの送信元検証が必要かどうかを検討
- サードパーティに送信する前にデューデリジェンスチェックを実行

### 検証とテスト

セキュリティ検証プロセスにロギングを含めます：
- ロギングが正しく一貫して機能することを確保
- メカニズムがインジェクション攻撃の影響を受けないことをテスト
- ログ記録発生時に望ましくない副作用がないことを確保
- ログ記録失敗の影響をテスト（データベース接続喪失、ファイルシステム問題）
- イベントログデータのアクセス制御を検証
- ロギングがリソース枯渇によるサービス拒否を引き起こさないことを確保

### 監視と運用

- アプリケーションロギングを集中ログ管理システムに組み込む
- 重大なイベントのアラートを有効化し、チームへの即座の通知を行う
- ログ記録が停止したり改ざんされたことを検出
- 検出システムとインテリジェンス収集と関連イベント情報を共有
- 法的/規制要件に応じて適切なログ保持期間を維持

### ログ攻撃に対する保護

ログは以下の攻撃の標的となる可能性があります：

**機密性**：ログに保存された機密情報への不正アクセス
**整合性**：ログデータの改ざんまたは悪用のためのログ活用
**可用性**：ログをフラッディングしてリソースを枯渇させるか、さらなるログ記録を防止
**説明責任**：ログ書き込みの防止または痕跡を隠すための誤ったアイデンティティロギングの引き起こし

ログシステムのセキュリティと信頼性を維持しながら、これらの攻撃ベクトルから保護するための適切な制御を実装します。
