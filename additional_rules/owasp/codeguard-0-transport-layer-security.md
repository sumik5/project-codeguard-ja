---
description: トランスポート層セキュリティ
languages:
- c
- go
- java
- javascript
- php
- python
- ruby
- typescript
- yaml
alwaysApply: false
---

## トランスポート層セキュリティ

適切なプロトコル、暗号、証明書の設定を通じて、機密性、完全性、認証を提供するクライアント-サーバー通信を保護するためのTLSの安全な実装。


### TLSセキュリティの利点

正しく実装された場合、TLSは以下を提供します：
- 機密性：攻撃者がトラフィックの内容を読み取ることからの保護
- 完全性：トラフィックの変更とリプレイ攻撃からの保護
- 認証：クライアントによる正規サーバー接続の確認

### プロトコルセキュリティ

#### 強力なTLSプロトコルのみを使用
汎用Webアプリケーションは、必要に応じてTLS 1.2サポートを伴い、デフォルトでTLS 1.3にすべきです。

プロトコル要件：
- デフォルトでTLS 1.3を有効化
- レガシークライアント互換性が必要な場合のみTLS 1.2をサポート
- TLS 1.0、TLS 1.1、SSL v2、SSL v3を完全に無効化
- フォールバックが必要な場合、ダウングレード攻撃を防ぐためTLS_FALLBACK_SCSV拡張を有効化
- 注：PCI DSSはTLS 1.0などのレガシープロトコルを禁止

#### 強力な暗号スイートの設定
適切なセキュリティレベルを提供する強力な暗号のみを使用します。

暗号要件：
- 可能な場合GCM暗号を優先
- null暗号、匿名暗号、EXPORT暗号を常に無効化
- セキュリティと互換性のバランスのためMozilla Foundation安全設定ジェネレーターを使用

#### 適切なDiffie-Hellmanグループの設定
鍵交換のため安全なDiffie-Hellmanパラメータを設定します。

TLS 1.3グループ：ffdhe2048、ffdhe3072、ffdhe4096、ffdhe6144、ffdhe8192

設定例：

```text
# OpenSSL設定
openssl_conf = openssl_init
[openssl_init]
ssl_conf = ssl_module
[ssl_module]
system_default = tls_system_default
[tls_system_default]
Groups = x25519:prime256v1:x448:ffdhe2048:ffdhe3072
```

```text
# Apache設定
SSLOpenSSLConfCmd Groups x25519:secp256r1:ffdhe3072
```

```text
# NGINX設定
ssl_ecdh_curve x25519:secp256r1:ffdhe3072;
```

#### TLS圧縮の無効化
セッションCookieのような機密情報を回復できるCRIME攻撃から保護するため、TLS圧縮を無効化します。

#### 暗号化ライブラリを最新に保つ
Heartbleedのような脆弱性から保護するため、SSL/TLSライブラリの現在のバージョンを維持します。

### 証明書管理

#### 強力な鍵と保護を使用
最小2048ビットの鍵サイズで証明書を生成し、ファイルシステム権限とアクセス制御を使用して不正アクセスから秘密鍵を保護します。

#### 強力な暗号化ハッシュを使用
証明書は、非推奨のMD5とSHA-1アルゴリズムではなく、ハッシュアルゴリズムにSHA-256を使用する必要があります。

#### 正しいドメイン名を使用
証明書のドメイン名は、commonName（CN）とsubjectAlternativeName（SAN）属性の両方でサーバーのFQDNと一致する必要があります。

#### ワイルドカード証明書のリスクを考慮
ワイルドカード証明書は最小権限の原則に違反します。真の必要性が存在する場合のみ使用し、異なる信頼レベルのシステムには決して使用しないでください。

#### 適切な認証局を使用
インターネット向けアプリケーションには信頼されたCAを選択します。無料のドメイン検証証明書にはLetsEncryptを検討してください。

### アプリケーション実装

#### すべてのページにTLSを使用
HTTP 301リダイレクトとHSTSヘッダーサポートでアプリケーション全体にTLSを実装します。

#### 混在コンテンツを防止
セッションCookieのスニッフィングと悪意のあるコード注入を防ぐため、すべてのJavaScript、CSS、リソースをHTTPS経由でロードします。

#### セキュアCookieフラグを使用
暗号化されたHTTPS接続のみに送信を制限するため、すべてのCookieに「Secure」属性でマークします。

#### 機密データのキャッシングを防止
キャッシュ防止ヘッダーを使用：

```text
Cache-Control: no-cache, no-store, must-revalidate
Pragma: no-cache
Expires: 0
```

#### HTTP Strict Transport Securityの実装
HSTSはブラウザに常にHTTPS経由でサイトを要求するよう指示し、証明書警告のバイパスを防ぎます。

#### クライアント証明書と相互TLSを検討
mTLSは相互認証を提供しますが、重大な管理オーバーヘッドを伴います。技術的に洗練されたユーザーを持つ高価値アプリケーションに推奨されます。

#### ブラウザでの公開鍵ピンニングを避ける
HPKPは非推奨であり、最新のブラウザではサポートされていません。制御された環境でのみピンニングを検討してください。

### テストと検証

SSL Labs Server Test、testssl.sh、SSLyze、その他の推奨されるオンラインおよびオフラインテストツールを使用してTLS設定をテストします。

### 実装ガイドライン

1. 必要な場合のみTLS 1.2フォールバックでデフォルトはTLS 1.3
2. すべてのレガシープロトコル（TLS 1.0/1.1、SSL v2/v3）を無効化
3. GCM優先で強力な暗号スイートを設定
4. 鍵交換のため適切なDiffie-Hellmanグループを設定
5. CRIME攻撃を防ぐためTLS圧縮を無効化
6. SHA-256ハッシュで最小2048ビットの証明書鍵を使用
7. 証明書のCNとSANフィールドに正しいドメイン名を確保
8. HTTPからの301リダイレクトですべてのページにHTTPSを実装
9. HTTPS経由ですべてのリソースをロードして混在コンテンツを防止
10. すべてのCookieにSecureフラグを設定
11. 適切なHTTPヘッダーで機密データのキャッシングを防止
12. ブラウザ強制のためHSTSを実装
13. 高価値アプリケーションにmTLSを検討
14. ブラウザでの公開鍵ピンニングを避ける
15. 推奨ツールでTLS設定の定期的テスト
