---
description: NPMセキュリティベストプラクティス
languages:
- javascript
alwaysApply: false
---

## NPMセキュリティガイドライン

JavaScriptプロジェクトでNPMパッケージと依存関係を管理するための必須セキュリティプラクティス。

### シークレット漏洩の防止

npmレジストリへの機密データの公開を避ける：
- package.jsonの`files`プロパティを許可リストとして使用して公開内容を制御
- `.gitignore`と`.npmignore`に注意 - 両方が存在する場合、`.npmignore`が優先
- 実際の公開前に`npm publish --dry-run`を実行してtarballの内容を確認
- NPMは公開されたパッケージで検出されたトークンを自動的に失効するが、予防が最善

### 決定論的ビルドを強制

環境間で一貫した依存関係インストールを確保：
- CI/CDと本番ビルドで`npm install`の代わりに`npm ci`を使用
- Yarnを使用している場合は`yarn install --frozen-lockfile`を使用
- 対応するlockfileを更新せずにpackage.jsonへの変更をコミットしない
- Lockfileの不整合は意図しないパッケージバージョンを取得しセキュリティを損なう可能性

### スクリプト実行リスクを最小化

パッケージインストールスクリプトからの攻撃面を削減：
- パッケージインストール時に`--ignore-scripts`を追加：`npm install --ignore-scripts`
- `.npmrc`設定に`ignore-scripts=true`を追加することを検討
- インストール前に常にサードパーティパッケージの信頼性を確認
- 新しいバージョンへの即時アップグレードを避け、コミュニティのレビュー時間を確保
- 依存関係をアップグレードする前にchangelogとリリースノートを確認

### パッケージのヘルスをモニタリング

依存関係の状態を定期的に評価：
- `npm outdated`を使用して更新が必要なパッケージを識別
- `npm doctor`を実行してnpmインストールと環境が健全であることを確認
- `npm audit`を使用して依存関係の既知の脆弱性をモニタリング
- サードパーティオープンソースプロジェクトのセキュリティ脆弱性をスキャン
- プロジェクト依存関係に影響を与える新しいCVEのモニタリングを設定

### プライベートレジストリソリューションを使用

強化された制御のためにローカルnpmプロキシを使用することを検討：
- Verdaccioは軽量なプライベートレジストリソリューションを提供
- プライベートレジストリはパッケージアクセス制御と認証済みユーザーを提供
- プロキシ機能により重複ダウンロードを削減し帯域幅を節約
- セキュリティ制御のために異なるレジストリへの依存関係のルーティングを有効化
- テスト環境とモノレポプロジェクトに有用

### アカウントセキュリティを有効化

npm公開機能を保護：
- `npm profile enable-2fa auth-and-writes`で二要素認証を有効化
- プロフィール、ログイン、パッケージ管理の包括的保護のためにauth-and-writesモードを使用
- Auth-onlyモードはログインとプロフィール変更の保護のみを提供
- 2FAトークンにはGoogle Authenticatorなどの認証アプリを使用

### アクセストークンを安全に管理

npmレジストリへのプログラマティックアクセスを制御：
- `npm token create`を使用して最小限の必要な権限を持つトークンを作成
- 書き込みアクセスが不要な場合は読み取り専用トークンを使用
- `--cidr`オプションを使用してトークンを特定のIP範囲に制限
- `npm token list`でトークンを定期的に監査
- `npm token revoke`で未使用または侵害されたトークンを即座に失効
- ソースコード、ログ、環境変数でトークンを決して公開しない

### タイポスクワッティングに対する防御

悪意のあるパッケージ置換から保護：
- インストール前に`npm info <package>`でパッケージ名とメタデータを確認
- 信頼できないソースからのインストールコマンドをコピーペーストする際は特に注意
- ソースコードリポジトリとnpmレジストリをチェックしてパッケージの正当性を確認
- 日常の開発作業中はnpmからデフォルトでログアウト
- 未知のソースからパッケージをインストールする際は`--ignore-scripts`を使用

### 責任ある開示に従う

セキュリティ脆弱性を適切に処理：
- 脆弱性を報告する際は責任ある開示プログラムに従う
- 公開開示前にパッケージメンテナーと調整
- セキュリティ問題を公表する前に修正とアップグレードパスの時間を確保
- パッケージ作成者にセキュリティ懸念を報告するために適切なチャネルを使用

### パッケージ命名ベストプラクティス

npm命名ルールとセキュリティへの影響を理解：
- パッケージ名は214文字に制限、小文字のみ
- ドット、アンダースコアで始めることはできず、"~\'!()*"などの特殊文字を含めない
- タイポスクワッティング攻撃が人気のあるパッケージ名を標的にすることを認識
- NPMは新しいパッケージ公開のためにスパム検出メカニズムを使用
- 予約名にはnode_modulesとfavicon.icoが含まれる
