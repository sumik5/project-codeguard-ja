---
description: 認証情報スタッフィング防止のベストプラクティス
languages:
- c
- go
- java
- javascript
- php
- python
- ruby
- typescript
alwaysApply: false
---

## 認証情報スタッフィングとパスワードスプレー攻撃への防御

認証システムを実装する際、盗まれた認証情報を利用する自動攻撃を防御してください。これらの攻撃はますます洗練されており、多層防御戦略が不可欠です。

| 攻撃タイプ | 説明 |
|-------------|-------------|
| ブルートフォース | 辞書または他のソースから複数のパスワードを単一のアカウントに対してテスト |
| 認証情報スタッフィング | 他のサイトの侵害から取得したユーザー名/パスワードペアをテスト |
| パスワードスプレー | 単一の弱いパスワードを多数の異なるアカウントに対してテスト |

MFAは、認証情報スタッフィング攻撃に対する最も効果的な防御です。攻撃者が有効な認証情報を持っていても、MFAは重要な障壁を作り出します。

### 1. 多要素認証（MFA）：主要な防御

MFAは認証情報ベースの攻撃の99.9%を阻止します。以下の場合にトリガーされるリスクベースMFAを実装：
- 新しいデバイスまたは場所
- プロキシ/VPN使用
- 最近のログイン失敗試行
- 高リスクアクション（管理者変更、金融取引）

管理機能と機密操作には常にMFAを要求します。

### 2. 層状制御：深層防御

* **CAPTCHA：** 失敗試行（≥3回）、プロキシ/VPN IP、ボットユーザーエージェント、高速度トラフィックに基づいてトリガー。

* **レート制限：** 複数の層を実装：
  - IP単位の制限（評判に基づいて3-15回の試行）
  - ユーザー単位の制限（アカウントごとに5回の試行）
  - 分散攻撃を検出するグローバル制限
  - 自動有効期限付きの一時ブロック

* **デバイスフィンガープリント：** ユーザーエージェント、言語、画面解像度、TLSフィンガープリントを追跡して異常パターンを検出。

* **予測不可能なユーザー名：** ユーザー名としてメールアドレスを避ける；生成された非連続の識別子を使用。

### 3. 追加の防御

* **マルチステップログイン：** JavaScriptトークン生成またはCSRFトークンを要求して、自動ツールを複雑化。

* **侵害パスワード検出：** [HaveIBeenPwned API](https://haveibeenpwned.com/API/v3)を使用して侵害データベースに対して新しいパスワードをチェックし、データ侵害で見つかったパスワードを拒否。

* **ユーザー通知：** 新しいデバイスからのログイン成功についてユーザーにアラートし、セッション管理ダッシュボードを提供。

### 4. 監視とアラート

* **攻撃検出：** 以下を監視：
  - 高いログイン失敗量（>100/分）
  - 多数の一意な攻撃IP（>50/分）
  - 異常なCAPTCHA解決率（>95%）
  - ホスティングプロバイダーからの分散攻撃

* **不可能な移動の検出：** 不可能な時間枠内で遠い場所からユーザーがログインしたように見える場合（商業飛行速度より速い）にアラート。

* **侵害インテリジェンス：** [HaveIBeenPwned API](https://haveibeenpwned.com/API/v3)と統合して、新たに侵害された認証情報を検出。

これらの層状防御は、良好なユーザーエクスペリエンスを維持しながら、攻撃コストを大幅に増加させます。
